language: nodeCreate public and private SSH keysjs
nodejs:
  - 6.9.1
notifications:
  email:
    onfailure: change
    onsuccess: change
addons:
  sshknownhosts:
    - 138.197.128.14 # your droplet IP goes here
branches:
  only:
    - staging
    - master
env:
  global:
    - REMOTEAPPDIR=mulligan/mulligan-api
    - REMOTEUSER=deploy
    - REMOTEHOST=138.197.128.14 # your droplet IP goes here
beforeinstall:
  - npm install -g npm@^2
install:
  - npm install --only=dev
beforescript:
  - chmod 600 deploy && mv deploy ~/.ssh/idrsa
script:
  - npm run build
after_success:
  - echo "Connecting to production server..."
  - ssh -tt deploy@138.197.128.14 << EOF
  - echo "Connected to production server."
  - cd mulligan/mulligan-api
  - echo "Updating application..."
  - git pull origin master
  - npm install
  - echo "Application updated."
  - echo "Launching production server..."
  - pm2 restart mulligan-api
  - exit $?
  - EOF
  - echo "Production server started successfully."
  - echo "Production environment deployed successfully!"
